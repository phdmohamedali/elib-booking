jQuery((function($){var $title_action=$(".edit-php.post-type-bkap_booking").find(".page-title-action:first");bkap_view_booking.labels.add_to_google_calendar&&($title_action.after('<div id="bkap_update_event_message"></div>'),$title_action.after('<a href="#" class="page-title-action" id="bkap_admin_add_to_calendar_booking">'+bkap_view_booking.labels.add_to_google_calendar+"</a>")),$title_action.after('<a href="#" class="page-title-action bkap_export_button" id="bkap_print">'+bkap_view_booking.labels.print_label+"</a>"),$title_action.after('<a href="#" class="page-title-action bkap_export_button" id="bkap_csv">'+bkap_view_booking.labels.csv_label+"</a>"),$title_action.after('<a href="'+bkap_view_booking.url.calendar_url+'" class="page-title-action">'+bkap_view_booking.labels.calendar_label+"</a>"),$(".wp-header-end").before('<div class="bkap-view-booking-messages"></div>'),$(".wp-header-end").before('<div class="bkap-view-booking-data" style="display:none;"></div>')})),jQuery(document).ready((function($){({init:function(){this.click()},click:function(){let self=this;$(".bkap_export_button").on("click",(function(e){e.preventDefault();let submitButton=$(this),type=$(this).prop("id").split("_");type=type[1],$(".bkap-view-booking-messages").html('<div id="bkap_myProgress"><div id="bkap_myBar" data-added="0">0%</div></div>'),submitButton.hasClass("button-disabled")||($(".bkap_export_button").addClass("button-disabled"),self.process_step(1,self,type))})),$("#bkap_admin_add_to_calendar_booking").on("click",(function(e){if(e.preventDefault(),bkap_view_booking.total_bookings_to_export>0){$("#bkap_update_event_message").html(bkap_view_booking.total_bookings_to_export_msg);var data={user_id:bkap_view_booking.user_id,action:"bkap_admin_booking_calendar_events"};jQuery.post(bkap_view_booking.ajax_url,data,(function(response){jQuery("#bkap_update_event_message").html(response.total_bookings_to_exported_msg),setTimeout((function(){jQuery("#bkap_update_event_message").html("")}),5e3)}))}else jQuery("#bkap_update_event_message").html(bkap_view_booking.no_bookings_to_export)}))},printBookings:function(){let printThis=document.getElementById("bkap_print_data").outerHTML,win=window.open();self.focus(),win.document.open(),win.document.write('<html><head><title>Print Bookings</title><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body>'),win.document.write(printThis),win.document.write("</body></html>"),win.document.close(),win.print()},process_step:function(step,self,csv_print){let total_items=$(".top .displaying-num").text();total_items=total_items.split(" "),total_items=total_items[0],total_items=parseInt(total_items.replace(/,/g,""));let done_items=$("#bkap_myBar").data("added");const bkapUrlParams=new URLSearchParams(window.location.search);let post_status=bkapUrlParams.has("post_status")?bkapUrlParams.get("post_status"):"",s=bkapUrlParams.has("s")?bkapUrlParams.get("s"):"",m=bkapUrlParams.has("m")?bkapUrlParams.get("m"):"",post_type=bkapUrlParams.has("post_type")?bkapUrlParams.get("post_type"):"",filter_products=bkapUrlParams.has("filter_products")?bkapUrlParams.get("filter_products"):"",filter_views=bkapUrlParams.has("filter_views")?bkapUrlParams.get("filter_views"):"",filter_action=bkapUrlParams.has("filter_action")?bkapUrlParams.get("filter_action"):"",paged=bkapUrlParams.has("paged")?bkapUrlParams.get("paged"):"",order=bkapUrlParams.has("order")?bkapUrlParams.get("order"):"",orderby=bkapUrlParams.has("orderby")?bkapUrlParams.get("orderby"):"",filter_customer=bkapUrlParams.has("filter_customer")?bkapUrlParams.get("filter_customer"):"",bkap_custom_startdate=bkapUrlParams.has("bkap_custom_startdate")?bkapUrlParams.get("bkap_custom_startdate"):"",bkap_custom_enddate=bkapUrlParams.has("bkap_custom_enddate")?bkapUrlParams.get("bkap_custom_enddate"):"",data={post_status:post_status,s:s,m:m,post_type:post_type,filter_products:filter_products,filter_views:filter_views,filter_action:filter_action,paged:paged,total_items:total_items,done_items:done_items,csv_print:csv_print,orderby:orderby,order:order,filter_customer:filter_customer,bkap_custom_startdate:bkap_custom_startdate,bkap_custom_enddate:bkap_custom_enddate,action:"bkap_do_ajax_export",step:step};jQuery.post(bkap_view_booking.ajax_url,data,(function(response){})).done((function(response){if("done"==response.step||response.error||response.success)if($(".bkap_export_button").removeClass("button-disabled"),response.error){var error_message=response.message;$(".bkap-view-booking-messages").html('<div class="updated error"><p>'+error_message+"</p></div>")}else $("#bkap_myBar").animate({width:"100%"},50,(function(){$(".bkap-view-booking-messages").html("")})),"print"==csv_print?(self.printBookings(),$(".bkap-view-booking-data").html("")):window.location=response.url;else{if("print"==csv_print){let content=response.html_data;1==step?$(".bkap-view-booking-data").html(content):$("#bkap_print_data").append(content)}$("#bkap_myBar").data("added",response.added),$("#bkap_myBar").animate({width:response.percentage+"%"},50,(function(){})),$("#bkap_myBar").text(response.percentage+"%"),self.process_step(parseInt(response.step),self,csv_print)}})).fail((function(response){window.console&&window.console.log&&console.log(response)}))}}).init(),$(".bkap_datepicker").datepicker({minDate:0,dateFormat:"yy-mm-dd",onSelect:function(selected,evnt){"bkap_custom_startdate"==evnt.id&&(jQuery("#bkap_custom_enddate").datepicker("option","minDate",new Date(selected)),""==$("#bkap_custom_enddate").val()&&$("#bkap_custom_enddate").val(selected)),"bkap_custom_enddate"==evnt.id&&""==$("#bkap_custom_startdate").val()&&$("#bkap_custom_startdate").val(selected)}}),$(".bkap_filter_view").on("change",(function(){"custom_dates"==$(".bkap_filter_view").val()?($("#bkap_custom_startdate").removeAttr("style"),jQuery("#bkap_custom_enddate").removeAttr("style")):($("#bkap_custom_startdate").css("display","none"),$("#bkap_custom_enddate").css("display","none"),$("#bkap_custom_startdate").val(""),$("#bkap_custom_enddate").val(""))}))})),jQuery((function($){var bkap_customer_filter_params=bkap_view_booking.bkap_customer_filter_params;function getEnhancedSelectFormatString(){return{language:{errorLoading:function(){return bkap_customer_filter_params.i18n_searching},inputTooLong:function(args){var overChars=args.input.length-args.maximum;return 1===overChars?bkap_customer_filter_params.i18n_input_too_long_1:bkap_customer_filter_params.i18n_input_too_long_n.replace("%qty%",overChars)},inputTooShort:function(args){var remainingChars=args.minimum-args.input.length;return 1===remainingChars?bkap_customer_filter_params.i18n_input_too_short_1:bkap_customer_filter_params.i18n_input_too_short_n.replace("%qty%",remainingChars)},loadingMore:function(){return bkap_customer_filter_params.i18n_load_more},maximumSelected:function(args){return 1===args.maximum?bkap_customer_filter_params.i18n_selection_too_long_1:bkap_customer_filter_params.i18n_selection_too_long_n.replace("%qty%",args.maximum)},noResults:function(){return bkap_customer_filter_params.i18n_no_matches},searching:function(){return bkap_customer_filter_params.i18n_searching}}}}try{$(document.body).on("bkap-view-booking-init",(function(){$(":input.bkap-view-booking, :input.chosen_select").filter(":not(.enhanced)").each((function(){var select2_args=$.extend({minimumResultsForSearch:10,allowClear:!!$(this).data("allow_clear"),placeholder:$(this).data("placeholder")},getEnhancedSelectFormatString());$(this).selectWoo(select2_args).addClass("enhanced")})),$(":input.bkap-view-booking-nostd, :input.chosen_select_nostd").filter(":not(.enhanced)").each((function(){var select2_args=$.extend({minimumResultsForSearch:10,allowClear:!0,placeholder:$(this).data("placeholder")},getEnhancedSelectFormatString());$(this).selectWoo(select2_args).addClass("enhanced")})),$(":input.bkap-customer-search-select-box").filter(":not(.enhanced)").each((function(){var select2_args={allowClear:!!$(this).data("allow_clear"),placeholder:$(this).data("placeholder"),minimumInputLength:$(this).data("minimum_input_length")?$(this).data("minimum_input_length"):"1",escapeMarkup:function(m){return m},ajax:{url:bkap_customer_filter_params.ajax_url,dataType:"json",delay:1e3,data:function(params){return{term:params.term,action:"woocommerce_bkap_view_bookings_json_search_customers",security:bkap_customer_filter_params.search_customers_nonce,exclude:$(this).data("exclude")}},processResults:function(data){var terms=[];return data&&$.each(data,(function(id,text){terms.push({id:id,text:text})})),{results:terms}},cache:!0}};if(select2_args=$.extend(select2_args,getEnhancedSelectFormatString()),$(this).selectWoo(select2_args).addClass("enhanced"),$(this).data("sortable")){var $select=$(this),$list=$(this).next(".select2-container").find("ul.select2-selection__rendered");$list.sortable({placeholder:"ui-state-highlight select2-selection__choice",forcePlaceholderSize:!0,items:"li:not(.select2-search__field)",tolerance:"pointer",stop:function(){$($list.find(".select2-selection__choice").get().reverse()).each((function(){var id=$(this).data("data").id,option=$select.find('option[value="'+id+'"]')[0];$select.prepend(option)}))}})}}))})).on("wc_backbone_modal_before_remove",(function(){$(".bkap-view-booking, :input.bkap-customer-search-select-box").filter(".select2-hidden-accessible").selectWoo("close")})).trigger("bkap-view-booking-init"),$("html").on("click",(function(event){this===event.target&&$(".bkap-view-booking, :input.bkap-customer-search-select-box").filter(".select2-hidden-accessible").selectWoo("close")}))}catch(err){window.console.log(err)}}));
