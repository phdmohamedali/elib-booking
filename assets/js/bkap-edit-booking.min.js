jQuery("a.bkap-cancel-booking-cancel-button").on("click",(function(){return!!window.confirm("Are you sure you want to cancel this booking?")}));var bkap_edit_booking_class=function($){return $("body").on("bkap_price_updated",(function(e,confirm_button_id){var confirm_button="#confirm_bookings_"+confirm_button_id,bkap_settings=JSON.parse(bkap_process_params.bkap_settings),time_slot=$("#modal-body-"+confirm_button_id).find("#time_slot"),start=$("#modal-body-"+confirm_button_id).find("#wapbk_hidden_date"),end=$("#modal-body-"+confirm_button_id).find("#wapbk_hidden_date_checkout");if(time_slot.length>0)$(time_slot).val()?$(confirm_button).prop("disabled",!1):$(confirm_button).prop("disabled",!0);else if("on"==bkap_settings.booking_enable_multiple_day&&start.length>0&&end.length>0)$(start).val()&&$(end).val()?$(confirm_button).prop("disabled",!1):$(confirm_button).prop("disabled",!0);else{var is_available=""!=bkap_edit_params.bkap_cart_item_key&&bkap_edit_params.bkap_cart_item_key.indexOf("_")>=0?"yes":"no";"yes"==(is_available="view-order"!=bkap_edit_params.bkap_page_type?"yes":is_available)&&$(confirm_button).prop("disabled",!1)}})),$("body").on("bkap_before_price_updated",(function(e,confirm_button_id){$("#confirm_bookings_"+confirm_button_id).prop("disabled",!0)})),$("body").on("bkap_update_addon_prices",(function(e,confirm_button_id,options_total){var pro_addons=window["bkap_edit_params_"+confirm_button_id].bkap_cart_item.addons,price=parseFloat($("#total_price_calculated").val()),addon_total=0;if(pro_addons.length>0)for(i=0;i<pro_addons.length;i++){if(pro_addons[i].price>0)switch(pro_addons[i].price_type){case"percentage_based":addon_total+=price*pro_addons[i].price/100;break;case"flat_fee":case"quantity_based":addon_total+=pro_addons[i].price}}var booking_totals=price+parseFloat(addon_total);$("#total_price_calculated").val(booking_totals),$("#bkap_price_charged").val(booking_totals)})),{bkap_edit_modal:document.getElementById("bkap_edit_modal"),bkap_edit_bookings:function(product_id,bkap_cart_item_key,number){-1!==(bkap_cart_item_key=bkap_cart_item_key.toString()).indexOf(".")?bkap_cart_item_key=bkap_cart_item_key.replace(".","_"):0==number&&(bkap_cart_item_key=bkap_cart_item_key+"_"+number);var bkap_init_params=window["bkap_init_params_"+product_id];window.bkap_init_params=bkap_init_params;var bkap_process_params=window["bkap_process_params_"+product_id],settings=JSON.parse(bkap_process_params.additional_data);if("cart"==settings.bkap_page&&jQuery('button[name="update_cart"]').length>0&&!jQuery('button[name="update_cart"]').is(":disabled"))return void alert(settings.bkap_update_cart_msg);bkap_process_params.bkap_cart_item_key=bkap_cart_item_key,window.bkap_process_params=bkap_process_params;var bkap_edit_params=window["bkap_edit_params_"+bkap_cart_item_key];window.bkap_edit_params=bkap_edit_params;var chosen_fixed_block="";if($("#modal-body-"+bkap_cart_item_key+" #chosen_fixed_block").length>0){chosen_fixed_block=$("#modal-body-"+bkap_cart_item_key+" #chosen_fixed_block").val(),$("#modal-body-"+bkap_cart_item_key+" #block_option").val(chosen_fixed_block);var exploded_id=chosen_fixed_block.split("&");jQuery("#modal-body-"+bkap_cart_item_key+" #bkap-booking-form #block_option_start_day").val(exploded_id[0]),jQuery("#modal-body-"+bkap_cart_item_key+" #bkap-booking-form #block_option_number_of_day").val(exploded_id[1]),jQuery("#modal-body-"+bkap_cart_item_key+" #bkap-booking-form #block_option_price").val(exploded_id[2])}var resource_id="";let $id=`#modal-body-${bkap_cart_item_key} #chosen_resource_id`;if($($id).length>0&&""!==(resource_id=jQuery($id).val())&&bkap_functions.mark_resource_as_checked_frontend(resource_id,settings,`#modal-body-${bkap_cart_item_key} #bkap_front_resource_selection`),$("#modal-body-"+bkap_cart_item_key+" #chosen_person").length>0){let person=$("#modal-body-"+bkap_cart_item_key+" #chosen_person").val();$("#modal-body-"+bkap_cart_item_key+" #bkap_field_persons").val(person)}$("#modal-body-"+bkap_cart_item_key+' input[id^="chosen_person_"]').length>0&&$("#modal-body-"+bkap_cart_item_key+' input[id^="chosen_person_"]').each((function(i,row){let person_id=jQuery(this)[0].id.split("_")[2],person_val=jQuery(this).val();""==person_val&&(person_val=0),$("#modal-body-"+bkap_cart_item_key+" #bkap_field_persons_"+person_id).val(person_val)})),bkap_process_init($,bkap_process_params),document.getElementById("bkap_edit_modal_"+bkap_cart_item_key).style.display="block",$("body").trigger("bkap_edit_popup_enabled",[product_id,bkap_cart_item_key]);var other_data,global_settings=JSON.parse(bkap_process_params.global_settings),bkap_settings=JSON.parse(bkap_process_params.bkap_settings),calendar_type="",checkin_class="",checkout_class="",variation_id=bkap_edit_params.bkap_cart_item.variation_id,time_slot_lockout="",attr_lockout="",booking_checkin_div="#modal-body-"+bkap_cart_item_key+" #bkap-booking-form #bkap_start_date ";if(booking_checkout_div="#modal-body-"+bkap_cart_item_key+" #bkap-booking-form #bkap_end_date ","on"===bkap_settings.enable_inline_calendar?(calendar_type="inline",checkin_class=booking_checkin_div+"#inline_calendar",checkout_class=booking_checkout_div+"#inline_calendar_checkout"):(calendar_type="normal",checkin_class=booking_checkin_div+"#booking_calender",checkout_class=booking_checkout_div+"#booking_calender_checkout"),$(field_name="#wapbk_timeslot_lockout_"+variation_id).length>0&&(time_slot_lockout=$(field_name).val()),void 0!==settings.wapbk_attribute_list){var attribute_list=settings.wapbk_attribute_list.split(",");for(i=0;i<attribute_list.length;i++)if(""!=attribute_list[i]&&$("#"+attribute_list[i]).val()>0){var field_name="#wapbk_timeslot_lockout_"+attribute_list[i];$(field_name).length>0&&(attr_lockout=attr_lockout+attribute_list[i]+","+$(field_name).val()+";")}}var time_slots="";if("on"===bkap_settings.booking_enable_time||"dates_time"===bkap_settings.booking_enable_time)time_slots=bkap_settings.booking_time_settings;else if("duration_time"===bkap_settings.booking_enable_time)time_slots=bkap_settings.bkap_duration_settings;other_data={calendar_type:calendar_type,checkin_class:checkin_class,time_slots_arr:time_slots,variation_id:variation_id,time_slot_lockout:time_slot_lockout,attr_lockout:attr_lockout},""!==bkap_edit_params.bkap_booking_params.date&&default_display_date(settings,global_settings,bkap_settings,bkap_process_params,other_data);$(checkin_class).datepicker();var split=$("#modal-body-"+bkap_cart_item_key+" #wapbk_hidden_date").val().split("-");split[1]=split[1]-1;var CheckinDate=new Date(split[2],split[1],split[0]);Date.parse(CheckinDate);$(checkin_class).datepicker("option","defaultDate",CheckinDate),$(checkin_class).datepicker("option","setDate",CheckinDate),$(checkin_class).datepicker("option","beforeShow",(function(input,inst){$(booking_checkin_div+"#inline_calendar").append($("#ui-datepicker-div"));input.getBoundingClientRect();setTimeout((function(){inst.dpDiv.css({top:50,left:0})}),0)})),default_checkout_date=display_checkout_date(checkout_class),$(checkout_class).datepicker("option","beforeShow",(function(input,inst){$(booking_checkout_div+"#inline_calendar_checkout").append($("#ui-datepicker-div"));input.getBoundingClientRect();setTimeout((function(){inst.dpDiv.css({top:80,left:0})}),0)})),$("#inline_calendar").addClass("notranslate"),$("#inline_calendar_checkout").addClass("notranslate"),$("#ui-datepicker-div").addClass("notranslate"),setTimeout((function(){$("#confirm_bookings_"+bkap_cart_item_key).prop("disabled",!0)}),1500)},bkap_close_popup:function(product_id,bkap_cart_item_key){var modal=document.getElementById("bkap_edit_modal_"+bkap_cart_item_key),booking_obj=window.bkap_edit_params.bkap_booking_params;null!=booking_obj&&(null!=booking_obj.hidden_date&&$("#modal-body-"+bkap_cart_item_key+" #wapbk_hidden_date").val(booking_obj.hidden_date),null!=booking_obj.hidden_date_checkout&&$("#modal-body-"+bkap_cart_item_key+" #wapbk_hidden_date_checkout").val(booking_obj.hidden_date_checkout),null!=booking_obj.time_slot&&$("#modal-body-"+bkap_cart_item_key+"#show_time_slot #time_slot").val(booking_obj.time_slot)),modal.style.display="none",window.bkap_init_params="",window.bkap_process_params=""},bkap_confirm_booking:function(product_id,bkap_cart_item_key){var cart_item_obj={},cart_item_key=bkap_edit_params.bkap_cart_item_key,data={},booking_data={},booking_setting=JSON.parse(bkap_process_params.bkap_settings);let $id=`${MODAL_FORM_ID}#bkap_front_resource_selection`,settings=JSON.parse(window["bkap_process_params_"+product_id].additional_data);if(""!==bkap_edit_params.bkap_page_type&&"view-order"!==bkap_edit_params.bkap_page_type){if(void 0!==bkap_edit_params.bkap_cart_item&&bkap_edit_params.bkap_cart_item!=={}&&(cart_item_obj=bkap_edit_params.bkap_cart_item),jQuery(MODAL_DATE_ID+"select#booking_calender option").length>0?cart_item_obj.bkap_booking[0].date=jQuery(MODAL_DATE_ID+"#booking_calender option:selected").text():cart_item_obj.bkap_booking[0].date=$(MODAL_DATE_ID+"#booking_calender").val(),cart_item_obj.bkap_booking[0].hidden_date=$(MODAL_ID+"#wapbk_hidden_date").val(),cart_item_obj.bkap_booking[0].price=$(MODAL_ID+"#total_price_calculated").val(),void 0!==cart_item_obj.bkap_booking[0].diff_days&&(cart_item_obj.bkap_booking[0].diff_days=$(MODAL_ID+"#wapbk_diff_days").val()),""!==$(MODAL_END_DATE_ID+"#booking_calender_checkout").val()&&void 0!==$(MODAL_END_DATE_ID+"#booking_calender_checkout").val()&&""!==$(MODAL_ID+"#wapbk_hidden_date_checkout").val()&&void 0!==$(MODAL_ID+"#wapbk_hidden_date_checkout").val()&&(cart_item_obj.bkap_booking[0].date_checkout=$(MODAL_END_DATE_ID+"#booking_calender_checkout").val(),cart_item_obj.bkap_booking[0].hidden_date_checkout=$(MODAL_ID+"#wapbk_hidden_date_checkout").val()),""!==$(MODAL_FORM_ID+"#show_time_slot #time_slot").val()&&void 0!==$(MODAL_FORM_ID+"#show_time_slot #time_slot").val())cart_item_obj.bkap_booking[0].time_slot=$(MODAL_FORM_ID+"#show_time_slot #time_slot").val();else if(void 0!==cart_item_obj.bkap_booking[0].time_slot&&-1!==cart_item_obj.bkap_booking[0].time_slot.indexOf("<br>")){var values=new Array;jQuery.each(jQuery('input[name="time_slot[]"]:checked'),(function(){values+="<br>"+jQuery(this).val()})),values.length>0&&(time_slot_value=values,cart_item_obj.bkap_booking[0].time_slot=time_slot_value)}if($($id).length>0&&(cart_item_obj.bkap_booking[0].resource_id=bkap_functions.get_selected_resources_frontend(settings)),jQuery(MODAL_FORM_ID+"#bkap_field_persons").length>0){let person_val=jQuery(MODAL_FORM_ID+"#bkap_field_persons").val();""==person_val&&(person_val=0),cart_item_obj.bkap_booking[0].persons=[person_val]}else if(jQuery(MODAL_FORM_ID+'input[id^="bkap_field_persons_"]').length>0){let persons=[];jQuery(MODAL_FORM_ID+'input[id^="bkap_field_persons_"]').each((function(i,row){let person_id=jQuery(this)[0].id.split("_")[3],person_val=jQuery(this).val();""==person_val&&(person_val=0),0!=person_val&&persons.push({person_id:person_id,person_val:person_val})})),cart_item_obj.bkap_booking[0].persons=persons}if(""!==$(MODAL_ID+"#duration_time_slot").val()&&void 0!==$(MODAL_ID+"#duration_time_slot").val()&&(cart_item_obj.bkap_booking[0].duration_time_slot=$(MODAL_ID+"#duration_time_slot").val()),""!==$(MODAL_FORM_ID+"#bkap_duration_field").val()&&void 0!==$(MODAL_FORM_ID+"#bkap_duration_field").val()&&(duration_value=$(MODAL_FORM_ID+"#bkap_duration_field").val(),duration=booking_setting.bkap_duration_settings.duration,d_type=bkap_edit_params.bkap_booking_params.selected_duration.split("-"),duration_value*=duration,d_typee=d_type[1],duration_value=duration_value+"-"+d_typee,cart_item_obj.bkap_booking[0].selected_duration=duration_value),void 0!==cart_item_obj.bkap_booking[0].Deposit&&"yes"==booking_setting.booking_partial_payment_enable){var bpc=$(MODAL_ID+"#bkap_price_charged").val(),tpc=$(MODAL_ID+"#total_price_calculated").val();$(MODAL_ID+"#wapbk_diff_days").val();"security_deposit"==booking_setting.booking_partial_payment_radio?(cart_item_obj.bkap_booking[0].Deposit=bpc-tpc,cart_item_obj.bkap_booking[0].Remaining=tpc,cart_item_obj.bkap_booking[0].Total=parseFloat(bpc),cart_item_obj.bkap_booking[0].price=tpc):("value"==booking_setting.booking_partial_payment_radio||"percent"==booking_setting.booking_partial_payment_radio)&&(cart_item_obj.bkap_booking[0].Deposit=bpc,cart_item_obj.bkap_booking[0].Remaining=tpc-bpc,cart_item_obj.bkap_booking[0].Total=parseFloat(tpc),cart_item_obj.bkap_booking[0].price=bpc)}cart_item_obj.line_subtotal=$(MODAL_ID+"#total_price_calculated").val(),cart_item_obj.line_total=$(MODAL_ID+"#total_price_calculated").val(),data={cart_item_obj:cart_item_obj,cart_item_key:cart_item_key,page_type:bkap_edit_params.bkap_page_type,action:"bkap_update_edited_bookings"}}else if(""!==bkap_edit_params.bkap_page_type&&"view-order"===bkap_edit_params.bkap_page_type){if(jQuery(MODAL_DATE_ID+"select#booking_calender option").length>0)var booking_date=jQuery(MODAL_DATE_ID+"#booking_calender option:selected").text();else booking_date=$(MODAL_DATE_ID+"#booking_calender").val();if(booking_data={booking_date:booking_date,hidden_date:$(MODAL_ID+"#wapbk_hidden_date").val(),booking_date_checkout:$(MODAL_END_DATE_ID+"#booking_calender_checkout").val(),hidden_date_checkout:$(MODAL_ID+"#wapbk_hidden_date_checkout").val(),booking_price:$(MODAL_ID+"#total_price_calculated").val()},""==$(MODAL_DATE_ID+"#booking_calender").val()&&"on"==booking_setting.booking_purchase_without_date&&""!=document.getElementById("bkap_multidate_data").value&&(booking_data.bkap_multidate_data=JSON.parse(document.getElementById("bkap_multidate_data").value)),$($id).length>0&&(booking_data.resource_id=bkap_functions.get_selected_resources_frontend(settings)),jQuery(MODAL_FORM_ID+"#bkap_field_persons").length>0){let person_val=jQuery(MODAL_FORM_ID+"#bkap_field_persons").val();""==person_val&&(person_val=0),booking_data.persons=[person_val]}else if(jQuery(MODAL_FORM_ID+'input[id^="bkap_field_persons_"]').length>0){let persons=[];jQuery(MODAL_FORM_ID+'input[id^="bkap_field_persons_"]').each((function(i,row){let person_id=jQuery(this)[0].id.split("_")[3],person_val=jQuery(this).val();""==person_val&&(person_val=0),0!=person_val&&persons.push({person_id:person_id,person_val:person_val})})),booking_data.persons=persons}if($(MODAL_FORM_ID+"#show_time_slot #time_slot").val()&&(booking_data.time_slot=$(MODAL_FORM_ID+"#show_time_slot #time_slot").val()),void 0===booking_data.time_slot){values=new Array;jQuery.each(jQuery('input[name="time_slot[]"]:checked'),(function(){values.push(jQuery(this).val())})),values.length>0&&(time_slot_value=values.join(","),booking_data.time_slot=time_slot_value)}""!==$(MODAL_ID+"#duration_time_slot").val()&&void 0!==$(MODAL_ID+"#duration_time_slot").val()&&(booking_data.duration_time_slot=$(MODAL_ID+"#duration_time_slot").val()),""!==$(MODAL_FORM_ID+"#bkap_duration_field").val()&&void 0!==$(MODAL_FORM_ID+"#bkap_duration_field").val()&&(duration_value=$(MODAL_FORM_ID+"#bkap_duration_field").val(),duration=booking_setting.bkap_duration_settings.duration,d_type=bkap_edit_params.bkap_booking_params.selected_duration.split("-"),duration_value*=duration,d_typee=d_type[1],duration_value=duration_value+"-"+d_typee,booking_data.selected_duration=duration_value),data={booking_data:booking_data,item_id:cart_item_key,product_id:product_id,order_id:bkap_edit_params.bkap_order_id,page_type:bkap_edit_params.bkap_page_type,action:"bkap_update_edited_bookings"},void 0!==bkap_edit_params.bkap_booking_id&&(data.booking_post_id=bkap_edit_params.bkap_booking_id);var item_number=0;if(cart_item_key.indexOf("_")>=0){var item_split=cart_item_key.split("_");item_number=item_split[1]}void 0===document.getElementsByClassName("bkap_save")[item_number]&&(item_number=0),document.getElementsByClassName("bkap_save")[item_number].style.display="block",$("#confirm_bookings_"+cart_item_key).prop("disabled",!0),$("#bkap_edit_modal_"+cart_item_key+" #cancel_modal").prop("disabled",!0)}$.post(bkap_process_params.ajax_url,data,(function(response){null!=response.bkap_error?(document.getElementsByClassName("bkap_save")[item_number].style.display="none",$(MODAL_ID+".bkap-error").html('<div class="woocommerce-error">'+response.bkap_error+"</div>"),setTimeout((function(){$(MODAL_ID+".bkap-error").html("")}),5e3)):(bkap_edit_booking_class.bkap_close_popup(product_id,bkap_cart_item_key),"cart"===bkap_edit_params.bkap_page_type?$(document.body).trigger("wc_update_cart"):"checkout"===bkap_edit_params.bkap_page_type?$(document.body).trigger("update_checkout"):"view-order"===bkap_edit_params.bkap_page_type&&(document.getElementsByClassName("bkap_save")[item_number].style.display="none",window.location.reload()))}))}}}(jQuery);
