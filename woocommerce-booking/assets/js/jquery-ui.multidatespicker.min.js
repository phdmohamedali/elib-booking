!function($){$.extend($.ui,{multiDatesPicker:{version:"1.6.1"}}),$.fn.multiDatesPicker=function(method){var mdp_arguments=arguments,ret=this,mdp_events=(new Date,new Date(0),{});function removeDate(date,type){for(var i in type||(type="picked"),date=dateConvert.call(this,date),this.multiDatesPicker.dates[type])if(!methods.compareDates(this.multiDatesPicker.dates[type][i],date))return this.multiDatesPicker.dates[type].splice(i,1).pop()}function removeIndex(index,type){return type||(type="picked"),this.multiDatesPicker.dates[type].splice(index,1).pop()}function addDate(date,type,no_sort){type||(type="picked"),(date=dateConvert.call(this,date)).setHours(0),date.setMinutes(0),date.setSeconds(0),date.setMilliseconds(0),!1===methods.gotDate.call(this,date,type)&&(this.multiDatesPicker.dates[type].push(date),no_sort||this.multiDatesPicker.dates[type].sort(methods.compareDates))}function sortDates(type){type||(type="picked"),this.multiDatesPicker.dates[type].sort(methods.compareDates)}function dateConvert(date,desired_type,date_format){return desired_type||(desired_type="object"),methods.dateConvert.call(this,date,desired_type,date_format)}var methods={init:function(options){var $this=$(this);this.multiDatesPicker.changed=!1;var mdp_events={beforeShow:function(input,inst){this.multiDatesPicker.changed=!1,this.multiDatesPicker.originalBeforeShow&&this.multiDatesPicker.originalBeforeShow.call(this,input,inst)},onSelect:function(dateText,inst){var $this=$(this);if(this.multiDatesPicker.changed=!0,dateText&&$this.multiDatesPicker("toggleDate",dateText),"normal"==this.multiDatesPicker.mode&&this.multiDatesPicker.dates.picked.length>0&&this.multiDatesPicker.pickableRange){var min_date=this.multiDatesPicker.dates.picked[0],max_date=new Date(min_date.getTime());if(methods.sumDays(max_date,this.multiDatesPicker.pickableRange-1),this.multiDatesPicker.adjustRangeToDisabled){var c_disabled,disabled=this.multiDatesPicker.dates.disabled.slice(0);do{c_disabled=0;for(var i=0;i<disabled.length;i++)disabled[i].getTime()<=max_date.getTime()&&(min_date.getTime()<=disabled[i].getTime()&&disabled[i].getTime()<=max_date.getTime()&&c_disabled++,disabled.splice(i,1),i--);max_date.setDate(max_date.getDate()+c_disabled)}while(0!=c_disabled)}this.multiDatesPicker.maxDate&&max_date>this.multiDatesPicker.maxDate&&(max_date=this.multiDatesPicker.maxDate),$this.datepicker("option","minDate",min_date).datepicker("option","maxDate",max_date)}else $this.datepicker("option","minDate",this.multiDatesPicker.minDate).datepicker("option","maxDate",this.multiDatesPicker.maxDate);"INPUT"==this.tagName&&$this.val($this.multiDatesPicker("getDates","string")),this.multiDatesPicker.originalOnSelect&&dateText&&this.multiDatesPicker.originalOnSelect.call(this,dateText,inst),null!=$this.datepicker("option","altField")&&""!=$this.datepicker("option","altField")&&$($this.datepicker("option","altField")).val($this.multiDatesPicker("getDates","string"))},beforeShowDay:function(date){var $this=$(this),gotThisDate=!1!==$this.multiDatesPicker("gotDate",date),isDisabledCalendar=$this.datepicker("option","disabled"),isDisabledDate=!1!==$this.multiDatesPicker("gotDate",date,"disabled"),areAllSelected=this.multiDatesPicker.maxPicks==this.multiDatesPicker.dates.picked.length,custom=[!0,""];this.multiDatesPicker.originalBeforeShowDay&&(custom=this.multiDatesPicker.originalBeforeShowDay.call(this,date));var highlight_class=gotThisDate?"ui-state-highlight":custom[1];return[!(isDisabledCalendar||isDisabledDate||areAllSelected&&!highlight_class)&&custom[0],highlight_class]},onClose:function(dateText,inst){"INPUT"==this.tagName&&this.multiDatesPicker.changed&&($(inst.dpDiv[0]).stop(!1,!0),setTimeout('$("#'+inst.id+'").datepicker("show")',50)),this.multiDatesPicker.originalOnClose&&this.multiDatesPicker.originalOnClose.call(this,dateText,inst)}};options?(this.multiDatesPicker.originalBeforeShow=options.beforeShow,this.multiDatesPicker.originalOnSelect=options.onSelect,this.multiDatesPicker.originalBeforeShowDay=options.beforeShowDay,this.multiDatesPicker.originalOnClose=options.onClose,$this.datepicker(options),this.multiDatesPicker.minDate=$.datepicker._determineDate(this,options.minDate,null),this.multiDatesPicker.maxDate=$.datepicker._determineDate(this,options.maxDate,null),options.addDates&&methods.addDates.call(this,options.addDates),options.addDisabledDates&&methods.addDates.call(this,options.addDisabledDates,"disabled"),methods.setMode.call(this,options)):$this.datepicker(),$this.datepicker("option",mdp_events),"INPUT"==this.tagName&&$this.val($this.multiDatesPicker("getDates","string"));var altFieldOption=$this.datepicker("option","altField");altFieldOption&&$(altFieldOption).val($this.multiDatesPicker("getDates","string"))},compareDates:function(date1,date2){date1=dateConvert.call(this,date1),date2=dateConvert.call(this,date2);var diff=date1.getFullYear()-date2.getFullYear();return diff||(diff=date1.getMonth()-date2.getMonth())||(diff=date1.getDate()-date2.getDate()),diff},sumDays:function(date,n_days){var origDateType=typeof date;return obj_date=dateConvert.call(this,date),obj_date.setDate(obj_date.getDate()+n_days),dateConvert.call(this,obj_date,origDateType)},dateConvert:function(date,desired_format,dateFormat){var from_format=typeof date;if(from_format==desired_format){if("object"==from_format)try{date.getTime()}catch(e){return $.error("Received date is in a non supported format!"),!1}return date}var $this=$(this);if(void 0===date&&(date=new Date(0)),"string"!=desired_format&&"object"!=desired_format&&"number"!=desired_format&&$.error('Date format "'+desired_format+'" not supported!'),!dateFormat){dateFormat=$.datepicker._defaults.dateFormat;var dp_dateFormat=$this.datepicker("option","dateFormat");dp_dateFormat&&(dateFormat=dp_dateFormat)}switch(from_format){case"object":break;case"string":date=$.datepicker.parseDate(dateFormat,date);break;case"number":date=new Date(date);break;default:$.error('Conversion from "'+desired_format+'" format not allowed on jQuery.multiDatesPicker')}switch(desired_format){case"object":return date;case"string":return $.datepicker.formatDate(dateFormat,date);case"number":return date.getTime();default:$.error('Conversion to "'+desired_format+'" format not allowed on jQuery.multiDatesPicker')}return!1},gotDate:function(date,type){type||(type="picked");for(var i=0;i<this.multiDatesPicker.dates[type].length;i++)if(0===methods.compareDates.call(this,this.multiDatesPicker.dates[type][i],date))return i;return!1},getDates:function(format,type){switch(format||(format="string"),type||(type="picked"),format){case"object":return this.multiDatesPicker.dates[type];case"string":case"number":var o_dates=new Array;for(var i in this.multiDatesPicker.dates[type])o_dates.push(dateConvert.call(this,this.multiDatesPicker.dates[type][i],format));return o_dates;default:$.error('Format "'+format+'" not supported!')}},addDates:function(dates,type){if(dates.length>0){switch(type||(type="picked"),typeof dates){case"object":case"array":if(dates.length){for(var i in dates)addDate.call(this,dates[i],type,!0);sortDates.call(this,type);break}case"string":case"number":addDate.call(this,dates,type);break;default:$.error('Date format "'+typeof dates+'" not allowed on jQuery.multiDatesPicker')}$(this).datepicker("refresh")}else $.error("Empty array of dates received.")},removeDates:function(dates,type){type||(type="picked");var removed=[];if("[object Array]"===Object.prototype.toString.call(dates))for(var i in dates.sort((function(a,b){return b-a})))removed.push(removeDate.call(this,dates[i],type));else removed.push(removeDate.call(this,dates,type));return $(this).datepicker("refresh"),removed},removeIndexes:function(indexes,type){type||(type="picked");var removed=[];if("[object Array]"===Object.prototype.toString.call(indexes))for(var i in indexes.sort((function(a,b){return b-a})))removed.push(removeIndex.call(this,indexes[i],type));else removed.push(removeIndex.call(this,indexes,type));return $(this).datepicker("refresh"),removed},resetDates:function(type){type||(type="picked"),this.multiDatesPicker.dates[type]=[],$(this).datepicker("refresh")},toggleDate:function(date,type){if(type||(type="picked"),"daysRange"===this.multiDatesPicker.mode){this.multiDatesPicker.dates[type]=[];var end=this.multiDatesPicker.autoselectRange[1],begin=this.multiDatesPicker.autoselectRange[0];end<begin&&(end=this.multiDatesPicker.autoselectRange[0],begin=this.multiDatesPicker.autoselectRange[1]);for(var i=begin;i<end;i++)methods.addDates.call(this,methods.sumDays(date,i),type)}else!1===methods.gotDate.call(this,date)?methods.addDates.call(this,date,type):methods.removeDates.call(this,date,type)},setMode:function(options){var $this=$(this);switch(options.mode&&(this.multiDatesPicker.mode=options.mode),this.multiDatesPicker.mode){case"normal":for(option in options)switch(option){case"maxPicks":case"minPicks":case"pickableRange":case"adjustRangeToDisabled":this.multiDatesPicker[option]=options[option]}break;case"daysRange":case"weeksRange":var mandatory=1;for(option in options)switch(option){case"autoselectRange":mandatory--;case"pickableRange":case"adjustRangeToDisabled":this.multiDatesPicker[option]=options[option]}mandatory>0&&$.error("Some mandatory options not specified!")}mdp_events.onSelect&&mdp_events.onSelect(),$this.datepicker("refresh")}};return this.each((function(){if(this.multiDatesPicker||(this.multiDatesPicker={dates:{picked:[],disabled:[]},mode:"normal",adjustRangeToDisabled:!0}),methods[method]){var exec_result=methods[method].apply(this,Array.prototype.slice.call(mdp_arguments,1));switch(method){case"getDates":case"removeDates":case"gotDate":case"sumDays":case"compareDates":case"dateConvert":ret=exec_result}return exec_result}return"object"!=typeof method&&method?($.error("Method "+method+" does not exist on jQuery.multiDatesPicker"),!1):methods.init.apply(this,mdp_arguments)})),"gotDate"!=method&&"getDates"!=method&&(aaaa=1),ret};var dpuuid=(new Date).getTime();$.multiDatesPicker={version:!1},$.multiDatesPicker.initialized=!1,$.multiDatesPicker.uuid=(new Date).getTime(),$.multiDatesPicker.version=$.ui.multiDatesPicker.version,window["DP_jQuery_"+dpuuid]=$}(jQuery);
