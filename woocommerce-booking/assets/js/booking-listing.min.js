const bkapListing=function($){return{loading(isLoading){isLoading?$(".tyche_loader").show():$(".tyche_loader").hide()},eventRender(info,isAdmin){const extendedProps=info.event.extendedProps,bkapView=extendedProps.view;if(bkapListing.checkAvailability(info,isAdmin),extendedProps.resources){const resource=bkap_data.resource;let resource_data=extendedProps.resources.split("=>");bkapListing.addMeta(`${resource}: ${resource_data[1]}`,info.el.lastChild.childNodes[0])}if(isAdmin){let price=bkapListing.bkap_format_money(bkap_data.bkap_currency_args,extendedProps.price);bkapListing.addMeta(`${bkap_data.price}: ${price}`,info.el.lastChild.childNodes[0])}if("list"===bkapView)$(info.el).on("click",(function(e){null==e.target.getAttribute("href")&&e.preventDefault()})),bkapListing.addCta(info,info.el.lastChild)},checkAvailability(info,isAdmin){let extendedProp=info.event.extendedProps,view=extendedProp.view,calc=!0,start=info.event.start,m=start.getMonth(),date=start.getDate()+"-"+(m+1)+"-"+start.getFullYear(),holidays=info.event.extendedProps.holidays;-1!=jQuery.inArray(date,holidays)&&(calc=!1,$(info.el).hide());let bkapBooked=!1,booking_type=info.event.extendedProps.bookingType,show_time=info.event.extendedProps.showTime;"duration_time"==booking_type&&(calc=!1);var timeCall="date_time"==booking_type||"multidates_fixedtime"==booking_type;if("only_day"==booking_type||"multiple_days"==booking_type||"multidates"==booking_type||!show_time)var bkapCheckData={action:"bkap_date_lockout",post_id:info.event.id,date:info.event.start.toISOString(),cal_price:!0};if(timeCall&&show_time)bkapCheckData={action:"bkap_get_time_lockout",post_id:info.event.id,checkin_date:date,bkap_page:"product",timeslot_value:info.event.extendedProps.timeslot_value,date_time_type:"on",cal_price:!0};extendedProp.manage_time_availability&&(bkapListing.bkap_check_time_in_availability_data(info.event,date)||$(info.el).hide());if(extendedProp.resources){let resource_data=extendedProp.resources.split("=>");bkapCheckData.resource_id=resource_data[0]}if(null!=info.event.extendedProps.custom_range_dates){let custom_range=info.event.extendedProps.custom_range_dates;-1!=jQuery.inArray(date,custom_range)?calc=!0:(calc=!1,$(info.el).hide())}!isAdmin&&calc&&("list"==view&&(jQuery(".tyche_loader").show()),$.ajax({type:"post",url:woocommerce_params.ajax_url,data:bkapCheckData,success(response){const bkapMaxQty=response.max_qty;let price=response.price;price||(price=extendedProp.price);bkapBooked=!["FALSE"].includes(bkapMaxQty)&&("Unlimited"==bkapMaxQty||bkapMaxQty>0);const available_slots=bkap_data.available_slots;if(bkapBooked){$(info.el).find(".bkap-list-qty").each((function(ii,objj){$(this).attr("max",bkapMaxQty)})),$(info.el).find("input[name=bkap_price]").each((function(ii,objj){$(this).val(price)}));let price_format=bkapListing.bkap_format_money(bkap_data.bkap_currency_args,price);bkapListing.addMeta(`${available_slots}: ${bkapMaxQty}`,info.el.lastChild.childNodes[0]),bkapListing.addMeta(`${bkap_data.price}: ${price_format}`,info.el.lastChild.childNodes[0],{class:"bkap-meta-price"})}else{if("false"==info.event.extendedProps.greyOutBooked)return $(info.el).hide(),!1;$(info.el).addClass("bkap_greyOut"),$(info.el).find("input, .bkap-select-options").each((function(ii,objj){$(this).remove()})),$("<a/>",{text:bkap_data.sold_out,class:"bkap-sold-out bkap_greyOut",href:"#"}).appendTo(info.el.lastChild),bkapListing.addMeta(available_slots+": 0",info.el.lastChild.childNodes[0])}$(info.el).addClass("bkap_availability_checked")},complete(){"list"==view&&0}}))},bkap_check_time_in_availability_data(event_data,date){let manage_time_availability=event_data.extendedProps.manage_time_availability,timeslot="",from_date_obj="",to_date_obj="";if("duration_time"==event_data.extendedProps.bookingType)timeslot="00:01 - 23:59",from_date_obj=event_data.start,to_date_obj=event_data.end;else{timeslot=event_data.extendedProps.timeslot_value;let timeslot_split=timeslot.split(" - "),from_time=timeslot_split[0];from_time=from_time.replace(":","-");let to_time=timeslot_split[1];to_time=to_time.replace(":","-"),from_date_obj=bkapListing.bkap_create_date_obj_from_date_time(date+"-"+from_time),to_date_obj=bkapListing.bkap_create_date_obj_from_date_time(date+"-"+to_time)}let event_date=bkapListing.bkap_create_date_obj_from_date_time(date),final_timeslots_available=[],final_timeslots_disable=[];for(i=0;i<manage_time_availability.length;i++){let range=manage_time_availability[i],range_from_date="",range_to_date="",range_check=!1;switch(range.type){case"custom":var range_from_date_str=(range_from_split=(range_from=range.from).split("-"))[2]+"-"+range_from_split[1]+"-"+range_from_split[0];range_from_date=bkapListing.bkap_create_date_obj_from_date_time(range_from_date_str);var range_to_date_str=(range_to_split=(range_to=range.to).split("-"))[2]+"-"+range_to_split[1]+"-"+range_to_split[0];range_to_date=bkapListing.bkap_create_date_obj_from_date_time(range_to_date_str),range_check=!0;break;case"months":var range_from=range.from,range_to=range.to;range_from_date_str="01-"+range_from+"-"+(year=(new Date).getFullYear());if(range_from_date=bkapListing.bkap_create_date_obj_from_date_time(range_from_date_str),range_from<=range_to)range_to_date_str="30-"+range_to+"-"+year;else range_to_date_str="30-"+range_to+"-"+(year+=1);range_to_date=bkapListing.bkap_create_date_obj_from_date_time(range_to_date_str),range_check=!0;break;case"weeks":range_from=range.from,range_to=range.to;var year=(new Date).getFullYear(),from_week=new Date(year,0,1+7*(range_from-1)),fdow=from_week.getDay();range_from_date=from_week,fdow<=4?range_from_date.setDate(from_week.getDate()-from_week.getDay()+1):range_from_date.setDate(from_week.getDate()+8-from_week.getDay());var to_week=new Date(year,0,1+7*(range_to-1)),tdow=to_week.getDay();range_to_date=to_week,tdow<=4?range_to_date.setDate(to_week.getDate()-to_week.getDay()+1):range_to_date.setDate(to_week.getDate()+8-to_week.getDay()),range_to_date.setDate(range_to_date.getDate()+6),range_check=!0;break;case"days":var day1=parseInt(range.from),day2=parseInt(range.to),days="";if(day1==day2)days=day1.toString(),7==day1&&(days="0");else for(var i=0;i<7;i++)if(day1<7){if(days=days+day1+",",(day1+=1)==day2){7==day1&&(day1=0),days+=day1;break}7==day1&&(day1=0)}days=days.toString();var event_day=event_date.getDay().toString();days.includes(event_day)&&(range_from_date=bkapListing.bkap_create_date_obj_from_date_time(date),range_to_date=bkapListing.bkap_create_date_obj_from_date_time(date+"-23-59"),range_check=!0);break;case"time":case"time:range":case"time:0":case"time:1":case"time:2":case"time:3":case"time:4":case"time:5":case"time:6":var range_fromtime=range.from;range_fromtime=range_fromtime.replace(":","-");var range_totime=range.to;if(range_totime=range_totime.replace(":","-"),"time"==range.type)range_check=!0;else{var range_type_split=range.type.split(":");if("range"==range_type_split[1]){range_from_date_str=(range_from_split=(range_from=range.from_date).split("-"))[2]+"-"+range_from_split[1]+"-"+range_from_split[0];var range_from_split,range_to_split,range_fromdate=bkapListing.bkap_create_date_obj_from_date_time(range_from_date_str),range_todate=(range_to_date_str=(range_to_split=(range_to=range.to_date).split("-"))[2]+"-"+range_to_split[1]+"-"+range_to_split[0],bkapListing.bkap_create_date_obj_from_date_time(range_to_date_str));event_date.getTime()>=range_fromdate.getTime()&&event_date.getTime()<=range_todate.getTime()&&(range_check=!0)}else event_date.getDay()==range_type_split[1]&&(range_check=!0);range_check&&(range_from_date=bkapListing.bkap_create_date_obj_from_date_time(date+"-"+range_fromtime),range_to_date=bkapListing.bkap_create_date_obj_from_date_time(date+"-"+range_totime))}}if(range_check)if(parseInt(range.bookable))bkapListing.bkap_date_time_inside_mta_range(from_date_obj,to_date_obj,range_from_date,range_to_date)&&-1==final_timeslots_available.indexOf(timeslot)&&-1==final_timeslots_disable.indexOf(timeslot)&&final_timeslots_available.push(timeslot);else if(bkapListing.bkap_date_time_inside_mta_range(from_date_obj,to_date_obj,range_from_date,range_to_date)&&-1==final_timeslots_disable.indexOf(timeslot)&&-1==final_timeslots_available.indexOf(timeslot))return final_timeslots_disable.push(timeslot),!1}return!0},bkap_date_time_inside_mta_range:(from_date_obj,to_date_obj,range_from_date,range_to_date)=>from_date_obj.getTime()>range_from_date.getTime()&&from_date_obj.getTime()<range_to_date.getTime()||to_date_obj.getTime()>range_from_date.getTime()&&to_date_obj.getTime()<range_to_date.getTime()||from_date_obj.getTime()<=range_from_date.getTime()&&to_date_obj.getTime()>=range_to_date.getTime(),bkap_create_date_obj_from_date_time(date_time){let date_time_split=date_time.split("-");return date_time_split.length>3?new Date(date_time_split[2],date_time_split[1]-1,date_time_split[0],date_time_split[3],date_time_split[4]):new Date(date_time_split[2],date_time_split[1]-1,date_time_split[0])},addMeta(data,element,additional_info={}){let add_class="";null!=additional_info.class&&(add_class=" "+additional_info.class),$("<span/>",{html:data,class:"bkap-meta"+add_class}).appendTo(element)},bkap_format_money:function(bkap_currency_args,price){return accounting.formatMoney(parseFloat(price),{symbol:bkap_currency_args.currency_format_symbol,decimal:bkap_currency_args.currency_format_decimal_sep,thousand:bkap_currency_args.currency_format_thousand_sep,precision:bkap_currency_args.currency_format_num_decimals,format:bkap_currency_args.currency_format})},addCta(info,element){let add_to_cart_form=!1,extended_prop=info.event.extendedProps;"simple"===extended_prop.productType&&("only_day"===extended_prop.bookingType||"date_time"==extended_prop.bookingType&&extended_prop.showTime)&&(add_to_cart_form=!0);let resource_id=0;if(extended_prop.resources){resource_id=extended_prop.resources.split("=>")[0]}if(add_to_cart_form){const bookingForm=$("<form/>",{class:"bkap-list-form"}).appendTo(element);$("<input/>",{type:"hidden",name:"product_id",value:info.event.id}).appendTo(bookingForm),$("<input/>",{type:"hidden",name:"booking_calender",value:moment(info.event.start).format("YYYY-MM-DD")}).appendTo(bookingForm),$("<input/>",{type:"hidden",name:"wapbk_hidden_date",value:moment(info.event.start).format("D-M-YYYY")}).appendTo(bookingForm),$("<input/>",{type:"hidden",name:"bkap_price",value:""}).appendTo(bookingForm),"date_time"==extended_prop.bookingType&&$("<input/>",{type:"hidden",name:"time_slot",value:extended_prop.timeslot_value}).appendTo(bookingForm),"true"==info.event.extendedProps.showQuantity?$("<input/>",{class:"bkap-list-qty",name:"quantity",value:"1",type:"number",min:"1"}).appendTo(bookingForm):$("<input/>",{class:"bkap-list-qty",name:"quantity",value:"1",type:"hidden"}).appendTo(bookingForm),resource_id&&$("<input/>",{type:"hidden",name:"bkap_front_resource_selection",value:resource_id}).appendTo(bookingForm),$("<input/>",{class:"bkap-list-add-to-cart",type:"submit",name:"wapbk_hidden_date",value:bkap_data.add_to_cart}).appendTo(bookingForm)}else{let bkap_date_str="?bkap_date=";info.event.url.includes("?")&&(bkap_date_str="&bkap_date="),$("<a/>",{text:bkap_data.select_option,class:"bkap-select-options",href:`${info.event.url}${bkap_date_str}${moment(info.event.start).format("YYYY-MM-DD")}`,click(){window.location.href=this.href}}).appendTo(element)}}}}(jQuery);!function($){$(document).on("click",".bkap-list-add-to-cart",(function(e){e.preventDefault();const data=$(this).closest("form").serialize(),fc_list_item=$(this).closest(".bkap-list-form"),button=$(this);$.ajax({type:"post",url:woocommerce_params.wc_ajax_url.toString().replace("%%endpoint%%","add_to_cart"),data:data,beforeSend(){button.removeClass("added").addClass("loading"),fc_list_item.block({message:null,overlayCSS:{background:"#eee",opacity:.6}})},complete(){button.addClass("added").removeClass("loading"),fc_list_item.unblock()},success(response){response.error&&response.product_url?window.location=response.product_url:$(document.body).trigger("added_to_cart",[response.fragments,response.cart_hash,button])}})})),$(document).on("click","a.added_to_cart",(function(){window.location.href=this.href}))}(jQuery);
